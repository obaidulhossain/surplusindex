{% extends 'base.html' %}
{% block title %}
Get Assistance
{% endblock title %}


{% block content %}
{% load static %}
{% load custom_filters %}
<link href="{% static 'css/surplusindex.css' %}" rel="stylesheet">
<div class="help-container">
    <!-- LEFT SIDEBAR -->
    <div class="help-sidebar">
        <h4>Conversations</h4>

        <div class="conversation-list">
        <div id="unread-container">

        </div>
        {% for c in conversations %}
            {% if c.status == "open" %}
            <div class="conversation active {% if c.id == conv.id %}selected{% endif %}" data-conv-id="{{ c.id }}" onclick="loadConversationAdmin(this)">
                <strong>{{ c.client.username }}</strong>
                <span class="unread-badge" id="unread-{{ c.id }}"></span></br>
                <p>{{ c.title|truncatechars:35 }}</p>
                {% comment %} <p>{% if c.last_sender_id and c.last_sender_id != request.user.id %}Re: {% endif %}{{ c.last_msg|truncatechars:35 }}</p> {% endcomment %}
            </div>
            {% endif %}
        {% endfor %}
        {% for c in conversations %}
            {% if c.status == "closed" %}
            <div class="conversation" data-conv-id="{{ c.id }}" onclick="loadConversationAdmin(this)">
                <strong>{{ c.client.username }}</strong>
                <span class="unread-badge" id="unread-{{ c.id }}"></span></br>
                <p>{{ c.title|truncatechars:35 }}</p>
            </div>
            {% endif %}
        {% endfor %}
        </div>
    </div>

    <!-- RIGHT CHAT AREA -->
    <div class="help-chat">
        <!-- MESSAGES -->
        <div class="chat-messages" id="chatMessages">
            <div class="message received">
                Hello ðŸ‘‹ How can we help you?
            </div>
            
            {% for msg in con_messages %}
                <div class="message {{ msg.msgtype }}">
                    <div class="msg-text">{{ msg.text }}</div>
                    <div class="msg-time">{{ msg.sender.username|upper }} - {{ msg.message_time }}</div>
                    
                </div>
            {% endfor %}
            
        </div>

        <!-- INPUT -->
        <div class="chat-input">
            <input type="hidden" id="selectedchat" value="{{conv.id}}">
            <input type="text" id="chatInput" placeholder="Type your message..." />
            <button onclick="sendMessageAdmin()">Send <i class="bi bi-send"></i></button>
        </div>
    </div>
</div>

<script src="{% static 'js/Assistance.js' %}"></script>
{% endblock content %}